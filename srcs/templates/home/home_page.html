{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags markdown_extras %}

{% block title %}{{ page.title }}{% endblock %}

{% block body_class %}template-homepage{% endblock %}

{% block extra_css %}
{% comment %}
Delete the line below if you're just getting started and want to remove the welcome screen!
{% endcomment %}
<link rel="stylesheet" href="{% static 'css/home/home_page.css' %}">
{% endblock extra_css %}

{% block content %}
<div class="bg-white">
    {% if page.cover_image %}
    <div class="cover-image-container">
        {% image page.cover_image fill-1920x400 class="cover-image" %}
        <div class="cover-image-overlay"></div>
    </div>
    {% else %}
    <div class="cover-image-container">
        <img src="{% static 'images/default-cover.svg' %}" class="cover-image" alt="Default cover">
        <div class="cover-image-overlay"></div>
    </div>
    {% endif %}
    <!-- 제목 섹션 -->
    <div class="title-section">
        <div class="title-content">
            <h1 class="main-title">
                {{ page.title }}
            </h1>
            {% if page.intro %}
            <p class="intro-text">
                {{ page.intro|richtext }}
            </p>
            {% endif %}
        </div>
    </div>

    <!-- 최신 글 섹션 -->
    <div class="latest-posts-section">
        <div class="section-container">
            <h2 class="section-title">Latest</h2>
            <div class="grid">
                {% for post in page.get_latest_posts|slice:":3" %}
                    {% include "weblog/partials/post_card.html" with post=post %}
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- 블로그 섹션 -->
    <div class="blog-section">
        <div class="section-container">
            <h2 class="section-title">Series</h2>
            <div class="grid">
                <!-- 왼쪽: 큰 블로그 인덱스 -->
                {% with blog_index=page.get_blog_indexes|first %}
                    {% if blog_index %}
                        {% include "weblog/partials/post_card.html" with post=blog_index %}
                        {% for post in blog_index.get_children.specific.live|slice:":2" %}
                            {% include "weblog/partials/post_card.html" with post=post %}
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>
        </div>
    </div>

    <!-- 본문 섹션 -->
    {% if page.body %}
    <div class="body-section">
        <div class="section-container">
            <div class="content-wrapper">
                {% for block in page.body %}
                    {% if block.block_type == 'markdown' %}
                        {{ block.value|markdown_to_html|safe }}
                    {% elif block.block_type == 'heading' %}
                        <h2 class="content-heading">{{ block.value }}</h2>
                    {% elif block.block_type == 'paragraph' %}
                        {{ block.value|richtext }}
                    {% elif block.block_type == 'image' %}
                        {% image block.value width-800 class="content-image" %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
