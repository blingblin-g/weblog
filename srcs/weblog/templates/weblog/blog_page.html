{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags markdown_extras %}

{% block title %}{{ page.title }}{% endblock %}

{% block content %}
<style>
    .cover-container {
        position: relative;
        height: 32rem;
        overflow: hidden;
        cursor: pointer;
    }
    .cover-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: brightness(0.3);
        transition: all 0.7s ease-in-out;
    }
    .cover-container:hover .cover-image {
        transform: scale(1.1);
        filter: brightness(0.5);
    }
    .cover-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.4));
        transition: all 0.7s ease-in-out;
    }
    .cover-container:hover .cover-overlay {
        background: linear-gradient(to top, rgba(0,0,0,0.6), rgba(0,0,0,0.2));
    }
    .cover-center-content {
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 2;
        text-align: center;
        padding: 2rem;
    }
    .cover-title {
        color: #fff;
        font-size: 3rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
        text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        max-width: 800px;
    }
    .cover-meta {
        display: flex;
        gap: 1rem;
        color: #fff;
        font-size: 1.1rem;
        align-items: center;
        justify-content: center;
        text-shadow: 0 1px 4px rgba(0,0,0,0.4);
    }
    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .meta-separator {
        color: rgba(255, 255, 255, 0.6);
    }
    .cover-category {
        background: rgba(255,255,255,0.2);
        border-radius: 999px;
        padding: 0.25em 1em;
        margin-bottom: 1rem;
    }
    .cover-tags {
        margin-top: 0.75rem;
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: center;
    }
    .cover-tag {
        color: #fff;
        background: rgba(0,0,0,0.15);
        border-radius: 999px;
        padding: 0.15em 0.8em;
        font-size: 0.95em;
        text-shadow: 0 1px 4px rgba(0,0,0,0.3);
    }
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }
    .modal.active {
        display: flex;
        opacity: 1;
    }
    .modal-content {
        max-width: 90%;
        max-height: 90vh;
        margin: auto;
        position: relative;
    }
    .modal-image {
        max-width: 100%;
        max-height: 90vh;
        object-fit: contain;
    }
    .modal-close {
        position: absolute;
        top: -40px;
        right: 0;
        color: white;
        font-size: 30px;
        cursor: pointer;
        padding: 5px;
    }
</style>

<div class="bg-white">
    {% if page.cover_image %}
    <div class="cover-container" onclick="openModal()">
        {% image page.cover_image width-1920 class="cover-image" %}
        <div class="cover-overlay"></div>
        <div class="cover-center-content">
            {% if page.category %}
            <span class="cover-category">{{ page.category.name }}</span>
            {% endif %}
            <h1 class="cover-title">{{ page.title }}</h1>
            <div class="cover-meta">
                <div class="meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                    </svg>
                    <span>{{ page.view_count }}</span>
                </div>
                <span class="meta-separator">•</span>
                <div class="meta-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
                    </svg>
                    <span>{{ page.like_count }}</span>
                </div>
                <span class="meta-separator">•</span>
                <div class="meta-item">
                    <span class="cover-date">{{ page.first_published_at|date:"F j, Y" }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="imageModal" class="modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            {% image page.cover_image original class="modal-image" %}
        </div>
    </div>

    <script>
        function openModal() {
            document.getElementById('imageModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('imageModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // ESC 키로 모달 닫기
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>
    {% else %}
    <div class="relative mx-auto max-w-7xl px-6 lg:px-8">
        <div class="mx-auto max-w-2xl">
            <div class="text-center">
                <h1 class="mt-8 text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">
                    {{ page.title }}
                </h1>
                <div class="mt-16 flex items-center justify-center gap-x-4 text-sm">
                    <time datetime="{{ page.date|date:'Y-m-d' }}" class="text-gray-500">
                        {{ page.date|date:"Y. m. d. (D)" }}
                    </time>
                    {% if page.category %}
                    <span class="px-3 py-1 bg-gray-100 rounded-full text-gray-600">
                        {{ page.category.name }}
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <article class="relative mx-auto max-w-7xl px-6 lg:px-8">
        <div class="mx-auto max-w-2xl">
            <hr class="my-12 border-gray-200">
            <p class="mt-8 text-lg leading-8 text-gray-600">
                {{ page.intro }}
            </p>
            <div class="mt-12 max-w-2xl prose prose-lg prose-gray prose-img:rounded-xl prose-img:shadow-lg">
                {% for block in page.body %}
                    {% if block.block_type == 'markdown' %}
                        {{ block.value|markdown_to_html|safe }}
                    {% elif block.block_type == 'paragraph' %}
                        {{ block.value|richtext }}
                    {% elif block.block_type == 'image' %}
                        {% image block.value width-800 class="rounded-xl shadow-lg" %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </article>

    {% if page.get_children %}
    <div class="relative mx-auto max-w-7xl px-6 lg:px-8 mt-16">
        <div class="mx-auto max-w-2xl">
            <h2 class="text-2xl font-bold text-gray-900 mb-8">Related Posts</h2>
            <div class="grid grid-cols-1 gap-8">
                {% for child in page.get_children %}
                    {% if child.specific_class_name == 'BlogPage' %}
                    <div class="flex flex-col md:flex-row gap-6 p-6 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow">
                        {% if child.specific.cover_image %}
                        <div class="w-full md:w-48 h-32 overflow-hidden rounded-lg">
                            {% image child.specific.cover_image fill-400x300 class="w-full h-full object-cover" %}
                        </div>
                        {% endif %}
                        <div class="flex-1">
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">
                                <a href="{% pageurl child %}" class="hover:text-blue-600 transition-colors">
                                    {{ child.title }}
                                </a>
                            </h3>
                            <p class="text-gray-600 mb-4">{{ child.specific.intro|truncatechars:150 }}</p>
                            <div class="flex items-center gap-4 text-sm text-gray-500">
                                <time datetime="{{ child.specific.first_published_at|date:'Y-m-d' }}">
                                    {{ child.specific.first_published_at|date:"F j, Y" }}
                                </time>
                                {% if child.specific.category %}
                                <span class="px-3 py-1 bg-gray-100 rounded-full">
                                    {{ child.specific.category.name }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %} 